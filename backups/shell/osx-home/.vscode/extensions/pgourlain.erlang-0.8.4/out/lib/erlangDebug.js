(()=>{var e={1890:(e,t,s)=>{var n=s(1017),r=s(7147),i=parseInt("0777",8);function o(e,t,s,a){"function"==typeof t?(s=t,t={}):t&&"object"==typeof t||(t={mode:t});var u=t.mode,h=t.fs||r;void 0===u&&(u=i),a||(a=null);var l=s||function(){};e=n.resolve(e),h.mkdir(e,u,(function(s){if(!s)return l(null,a=a||e);switch(s.code){case"ENOENT":if(n.dirname(e)===e)return l(s);o(n.dirname(e),t,(function(s,n){s?l(s,n):o(e,t,l,n)}));break;default:h.stat(e,(function(e,t){e||!t.isDirectory()?l(s,a):l(null,a)}))}}))}e.exports=o.mkdirp=o.mkdirP=o,o.sync=function e(t,s,o){s&&"object"==typeof s||(s={mode:s});var a=s.mode,u=s.fs||r;void 0===a&&(a=i),o||(o=null),t=n.resolve(t);try{u.mkdirSync(t,a),o=o||t}catch(r){switch(r.code){case"ENOENT":o=e(n.dirname(t),s,o),e(t,s,o);break;default:var h;try{h=u.statSync(t)}catch(e){throw r}if(!h.isDirectory())throw r}}return o}},9440:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErlangShellForDebugging=t.FunctionBreakpoint=void 0;const n=s(2985),r=s(1017),i=s(2037),o=s(7147);t.FunctionBreakpoint=class{constructor(e,t,s,n,r){this.id=e,this.verified=!1,this.name=t,this.moduleName=s,this.functionName=n,this.arity=r}};class a extends n.GenericShell{constructor(e){super(e),this.breakPoints=[],this.functionBreakPoints=[]}Start(e,t,s,n,o){var a=Math.floor(1e7*Math.random()).toString();this.argsFileName=r.join(i.tmpdir(),r.basename(t)+"_"+a),this.argsPrecompiledFileName=r.join(i.tmpdir(),"bp_"+a+".erl"),this.argsPrecompiledFileName=this.formatPath(this.argsPrecompiledFileName);var u=["-noshell","-pa",`"${n}"`,"-s","int","-vscode_port",s.toString()];o.noDebug||u.push("-compiled_args_file",`"${this.argsPrecompiledFileName}"`),u.push("-s","vscode_connection","start");var h=this.createArgsFilev1(t,o.noDebug,o.addEbinsToCodepath,o.verbose),l=u.concat(h).concat([o.arguments]);return this.started=!0,this.LaunchProcess(e,t,l,!o.verbose)}CleanupAfterStart(){if(this.argsFileName&&o.existsSync(this.argsFileName)&&o.unlinkSync(this.argsFileName),this.argsPrecompiledFileName&&o.existsSync(this.argsPrecompiledFileName)){o.unlinkSync(this.argsPrecompiledFileName);var e=r.join(r.dirname(this.argsPrecompiledFileName),r.basename(this.argsPrecompiledFileName,".erl"))+".beam";o.existsSync(e)&&o.unlinkSync(e)}}uniqueBy(e,t){var s={},n=[];return e.forEach((function(e){var r=t(e);s[r]||(n.push(e),s[r]=!0)})),n}formatPath(e){return"win32"==i.platform()?null==e?e:e=e.split("\\").join("/"):e}findEbinDirs(e,t=[]){return o.readdirSync(e).forEach((s=>{const n=r.join(e,s);o.existsSync(n)&&o.statSync(n).isDirectory()&&("ebin"===s?t.push(n):this.findEbinDirs(n,t))})),t}findErlFiles(e,t=[]){return o.readdirSync(e).forEach((s=>{if("_build"==s)return;const n=r.join(e,s);o.existsSync(n)&&o.statSync(n).isDirectory()?this.findErlFiles(n,t):".erl"===r.extname(s)&&t.push(n)})),t}excludeUnwantedFiles(e){return".src"!=r.extname(e.source.path)}createArgsFilev1(e,t,s,n){var i=[];if(this.breakPoints){var a="";if(!t){let t=`-module(${r.basename(this.argsPrecompiledFileName,".erl")}).\r\n-export([configure/0]).\r\n\r\n`;t+="configure() -> \r\n int:start()\r\n",a+="-eval 'int:start()";var u={};this.findErlFiles(e).forEach((e=>{u[e]=!0}));var h=this.uniqueBy(this.breakPoints,(e=>e.source.path)).filter(this.excludeUnwantedFiles);for(var l in h.forEach((e=>{t+=',int:ni("'+this.formatPath(e.source.path)+'")\r\n',delete u[e.source.path]})),u)t+=',int:ni("'+this.formatPath(l)+'")\r\n';this.breakPoints.filter(this.excludeUnwantedFiles).forEach((e=>{var s=r.basename(e.source.name,".erl");t+=`,int:break(${s}, ${e.line})\r\n`})),this.functionBreakPoints.forEach((e=>{t+=`,vscode_connection:set_breakpoint(${e.moduleName}, {function, ${e.functionName}, ${e.arity}})\r\n`})),a+="'",t+=",ok.",n&&this.debug(`erl file '${this.argsPrecompiledFileName}' was generated with content : --\x3e\n${t}\n<--`),o.writeFileSync(this.argsPrecompiledFileName,t)}s&&this.findEbinDirs(r.join(e,"_build")).forEach((e=>{a+=' -pz "'+this.formatPath(e)+'"'})),o.writeFileSync(this.argsFileName,a),i.push("-args_file"),i.push('"'+this.argsFileName+'"')}return i}createArgsFilev0(e,t,s){var n=[];if(this.breakPoints){var i="";if(!t){i+="-eval 'int:start()";var a={};this.findErlFiles(e).forEach((e=>{a[e]=!0}));var u=this.uniqueBy(this.breakPoints,(e=>e.source.path));for(var h in u.forEach((e=>{i+=',int:ni(\\"'+this.formatPath(e.source.path)+'\\")',delete a[e.source.path]})),a)i+=',int:ni(\\"'+this.formatPath(h)+'\\")';this.breakPoints.forEach((e=>{var t=r.basename(e.source.name,".erl");i+=`,int:break(${t}, ${e.line})`})),this.functionBreakPoints.forEach((e=>{i+=`,vscode_connection:set_breakpoint(${e.moduleName}, {function, ${e.functionName}, ${e.arity}})`})),i+="'"}s&&this.findEbinDirs(r.join(e,"_build")).forEach((e=>{i+=' -pz "'+this.formatPath(e)+'"'})),o.writeFileSync(this.argsFileName,i),n.push("-args_file"),n.push('"'+this.argsFileName+'"')}return n}Compile(e,t){var s=[].concat(t);return this.RunProcess("erlc",e,s)}setBreakPointsRequest(e,t){this.started||(this.breakPoints=this.breakPoints.concat(e),this.functionBreakPoints=this.functionBreakPoints.concat(t))}}t.ErlangShellForDebugging=a},2985:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericShell=void 0;const n=s(2081),r=s(2361),i=s(7147),o=s(1017),a=/^(?:\d*|undefined)[\*\+\=]|[\~\@\&\^]/;class u extends r.EventEmitter{constructor(e,t,s){if(super(),this.buffer="",this.errbuf="",this.erlangPath=null,this.logOutput=e,this.shellOutput=t,s){let e=s.erlangPath;e&&(e.match(/^[A-Za-z]:/)?"win32"==process.platform&&(this.erlangPath=o.win32.normalize(e)):(e=o.normalize(e),i.existsSync(e)||(e=o.join(s.rootPath,e)),i.existsSync(e)&&(this.erlangPath=e)))}}RunProcess(e,t,s){return new Promise(((n,r)=>{this.LaunchProcess(e,t,s).then((e=>{this.on("close",(e=>{0==e?n(0):r(e)}))}))}))}LaunchProcess(e,t,s,r=!1){return new Promise(((i,o)=>{try{this.logOutput&&this.logOutput.show(),r||(this.erlangPath&&this.log("log",`using erlang binaries from path : '${this.erlangPath}'`),this.log("log",`starting : ${e} \r\n`+s.join(" ")));var a=null;if(this.erlangPath){a=process.env;var u="win32"==process.platform?";":":";a.PATH=this.erlangPath+u+a.PATH}this.childProcess=n.spawn(e,s,{cwd:t,shell:!0,stdio:"pipe",env:a}),this.childProcess.on("error",(t=>{this.log("stderr",t.message),"win32"==process.platform&&this.log("stderr","ensure '"+e+"' is in your path.")})),this.childProcess.stdout.on("data",this.stdout.bind(this)),this.childProcess.stderr.on("data",this.stderr.bind(this)),this.childProcess.on("exit",((t,s)=>{this.log("log",e+" exit code:"+t),this.emit("close",t)})),i(!0)}catch(e){o(e)}}))}onOutput(e){(e=e.split("\n")).forEach((e=>{this.log("stdout",e),this.appendToShellOutput(`${e}\n`)}))}onOutputPartial(e){return!!function(e){return!a.exec(e)}(e)&&(this.logNoNewLine("stdout",e),this.appendToShellOutput(e),!0)}stdout(e){this.buffer+="string"==typeof e?e:e.toString("utf8");let t=this.buffer.lastIndexOf("\n");-1!=t&&(this.onOutput(this.buffer.substr(0,t)),this.buffer=this.buffer.substr(t+1)),this.buffer.length&&this.onOutputPartial(this.buffer)&&(this.buffer="")}stderr(e){this.errbuf+="string"==typeof e?e:e.toString("utf8");let t=this.errbuf.lastIndexOf("\n");-1!=t&&(this.onOutputStderr(this.errbuf.substr(0,t)),this.errbuf=this.errbuf.substr(t+1)),this.errbuf.length&&(this.logNoNewLine("stderr",this.errbuf),this.errbuf="")}onOutputStderr(e){(e=e.split("\n")).forEach((e=>{this.log("stderr",e),this.appendToShellOutput(e)}))}logNoNewLine(e,t){this.logOutput&&this.logOutput.appendLine(t),this.emit("msg",e,t)}log(e,t){this.logOutput&&this.logOutput.appendLine(t),this.emit("msg",e,"\n"==t[t.length-1]?t:t+"\n")}debug(e){this.logOutput&&this.logOutput.debug(e)}Send(e){this.log("log",e),this.childProcess.stdin.write(e),this.childProcess.stdin.write("\r\n")}appendToShellOutput(e){this.shellOutput&&this.shellOutput.append(e)}}t.GenericShell=u},9987:function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ErlangConnection=t.setExtensionPath=t.erlangBridgePath=void 0;const r=s(2361),i=s(3685),o=s(1017),a=s(9440),u=s(7147),h=o.join("_build","default","lib","vscode_lsp");t.erlangBridgePath=o.join("lib","..","..",h),t.setExtensionPath=function(e){t.erlangBridgePath=o.join(e,h)};class l extends r.EventEmitter{constructor(e){super(),this._output=e,this.erlangbridgePort=-1,this.verbose=!0}get isConnected(){return this.erlangbridgePort>0}log(e){this._output&&this._output.appendLine(e)}logAppend(e){this._output}debug(e){this._output&&this._output.appendLine("debug:"+e)}error(e){this._output}Start(e){return n(this,void 0,void 0,(function*(){return this.verbose=e,new Promise(((e,t)=>{this.compile_erlang_connection().then((()=>this.start_events_receiver().then((t=>{e(t)}),(e=>{t(e)}))),(e=>{t(`Erlang compile failed : ${e}`)}))}))}))}compile_erlang_connection(){return new Promise(((e,s)=>{const n=o.join(t.erlangBridgePath,"..","ebin");this.log(`compiling erlang bridge to '${n}'`);var r=new a.ErlangShellForDebugging(this.verbose?this._output:null),i=this.get_ErlangFiles();u.existsSync(n)||u.mkdirSync(n);let h=["-o",o.normalize(n)].concat(i);return r.Compile(o.join(t.erlangBridgePath,"src"),h).then((t=>{e(t)}),(e=>{this.error("Compilation of erlang bridge...ko"),s(e)}))}))}start_events_receiver(){return this.verbose&&this.debug("Starting http listener..."),new Promise(((e,t)=>{this.events_receiver=i.createServer(((e,t)=>{var s=e.url,n=[],r=null;e.on("error",(e=>{this.error("request error")})).on("data",(e=>{n.push(e)})).on("end",(()=>{var e=Buffer.concat(n).toString();try{r=JSON.parse(e),this.handle_erlang_event(s,r)}catch(t){this.error("error while receving command :"+t+"\r\n"+e)}t.statusCode=200,t.setHeader("Content-Type","text/plain"),t.end("ok")}))})),this.events_receiver.listen(0,"127.0.0.1",(()=>{var t=this.events_receiver.address().port;this.verbose&&this.debug(` on http://127.0.0.1:${t}\n`),e(t)}))}))}post(e,t,s){return new Promise(((n,r)=>{t||(t="");var o={host:"127.0.0.1",path:e,port:this.erlangbridgePort,method:"POST",headers:{"Content-Type":"plain/text","Content-Length":Buffer.byteLength(t)}};s&&(o.headers["X-Multiline-Body"]="true");var a=i.request(o,(e=>{var t="";e.on("data",(e=>{t+=e})),e.on("end",(()=>{try{var e=JSON.parse(t);n(e)}catch(e){this.log("unable to parse response as JSON:"+e),r(e)}})),e.on("error",(e=>{this.log("error while sending command to erlang :"+e)}))}));a.write(t),a.end()}))}}t.ErlangConnection=l},2086:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErlangDebugConnection=void 0;const n=s(9987);class r extends n.ErlangConnection{get_ErlangFiles(){return["gen_connection.erl","vscode_connection.erl","vscode_jsone.erl"]}handle_erlang_event(e,t){switch(e){case"/listen":this.erlangbridgePort=t.port,this.emit("listen","erlang bridge listen on port :"+this.erlangbridgePort.toString());break;case"/interpret":this.emit("new_module",t.module);break;case"/new_process":this.emit("new_process",t.process);break;case"/new_status":this.emit("new_status",t.process,t.status,t.reason,t.module,t.line);break;case"/new_break":this.emit("new_break",t.module,t.line);break;case"/on_break":this.emit("on_break",t.process,t.module,t.line,t.stacktrace);break;case"/delete_break":break;case"/fbp_verified":this.emit("fbp_verified",t.module,t.name,t.arity);break;default:this.debug("receive from erlangbridge :"+e+", body :"+JSON.stringify(t))}}setBreakPointsRequest(e,t,s){if(this.erlangbridgePort>0){let n=e+"\r\n";return t.forEach((e=>{n+=`line ${e.line}\r\n`})),s.forEach((e=>{n+=`function ${e.functionName} ${e.arity}\r\n`})),this.post("set_bp",n).then((e=>!0),(e=>!1))}return new Promise((()=>!1))}debuggerContinue(e){return this.erlangbridgePort>0?this.post("debugger_continue",e).then((e=>!0),(e=>!1)):new Promise((()=>!1))}debuggerNext(e){return this.erlangbridgePort>0?this.post("debugger_next",e).then((e=>!0),(e=>!1)):new Promise((()=>!1))}debuggerStepIn(e){return this.erlangbridgePort>0?this.post("debugger_stepin",e).then((e=>!0),(e=>!1)):new Promise((()=>!1))}debuggerStepOut(e){return this.erlangbridgePort>0?this.post("debugger_stepout",e).then((e=>!0),(e=>!1)):new Promise((()=>!1))}debuggerPause(e){return this.erlangbridgePort>0?this.post("debugger_pause",e).then((e=>!0),(e=>!1)):new Promise((()=>!1))}debuggerBindings(e,t){return this.erlangbridgePort>0?this.post("debugger_bindings",e+"\r\n"+t).then((e=>e),(e=>(this.debug(`debugger_bindings error : ${e}`),[]))):new Promise((()=>[]))}debuggerEval(e,t,s){return this.erlangbridgePort>0?this.post("debugger_eval",e+"\r\n"+t+"\r\n"+s).then((e=>e),(e=>(this.debug(`debugger_eval error : ${e}`),[]))):new Promise((()=>[]))}debuggerExit(){return this.erlangbridgePort>0?this.post("debugger_exit","").then((e=>(this.debug("exit yes"),e)),(e=>(this.debug("exit no"),this.debug(`debugger_exit error : ${e}`),[]))):new Promise((()=>[]))}Quit(){this.debuggerExit().then((()=>{this.events_receiver.close()}))}}t.ErlangDebugConnection=r},1020:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErlangDebugSession=void 0;const n=s(420),r=s(9440),i=s(1017),o=s(7147),a=s(9987),u=s(2086);class h{constructor(e,t,s){this.condition=e,this.hitCount=parseInt(t),this.actualHitCount=0,this.logMessage=s}}class l extends n.DebugSession{constructor(e){super(),this._rebarBuildPath=i.join("_build","default","lib"),this._functionBreakPoints=new Map,this._conditionalBreakPoints=new Map,this._breakPoints=[],this._variableHandles=new n.Handles,this.threadIDs={},this.setDebuggerLinesStartAt1(!0),this.setDebuggerColumnsStartAt1(!1),process.addListener("unhandledRejection",(e=>{this.error(`******** Error in DebugAdapter - Unhandled promise rejection: ${e}`)})),process.addListener("uncaughtException",(e=>{this.error(`******** Error in DebugAdapter - uncaughtException: ${e}`)}))}threadsRequest(e){var t=[];for(var s in this.threadIDs){var r=this.threadIDs[s];r.vscode&&t.push(new n.Thread(r.thid,"Process "+s))}e.body={threads:t},this.sendResponse(e)}dispatchRequest(e){super.dispatchRequest(e)}resolveExtensionPath(){var e;if((null===(e=process.argv)||void 0===e?void 0:e.length)>0&&!i.isAbsolute(a.erlangBridgePath)){const e=i.join(i.dirname(process.argv[1]),"..","..");a.setExtensionPath(e)}}initializeRequest(e,t){this.erlDebugger=new r.ErlangShellForDebugging(this),this.erlDebugger.on("close",(e=>{this.quitEvent(e)})),this.resolveExtensionPath(),this.erlangConnection=new u.ErlangDebugConnection(this),this.erlangConnection.on("listen",(e=>this.onStartListening(e))),this.erlangConnection.on("new_module",(e=>this.onNewModule(e))),this.erlangConnection.on("new_break",(e=>this.onNewBreak(e))),this.erlangConnection.on("new_process",(e=>this.onNewProcess(e))),this.erlangConnection.on("new_status",((e,t,s,n,r)=>this.onNewStatus(e,t,s,n,r))),this.erlangConnection.on("on_break",((e,t,s,n)=>this.onBreak(e,t,s,n))),this.erlangConnection.on("fbp_verified",((e,t,s)=>this.onFbpVerified(e,t,s))),e.body.supportsConfigurationDoneRequest=!0,e.body.supportsConditionalBreakpoints=!0,e.body.supportsHitConditionalBreakpoints=!0,e.body.supportsLogPoints=!0,e.body.supportsFunctionBreakpoints=!0,e.body.supportsEvaluateForHovers=!0,e.body.supportsSetVariable=!1,e.body.supportsStepBack=!1,e.body.exceptionBreakpointFilters=[],this.sendResponse(e)}launchRequest(e,t){if(t.erlpath){if(!o.existsSync(t.erlpath))return this.log("The specified erlPath in your launch.json is invalid. Please fix !"),void this.sendErrorResponse(e,3e3,"The specified erlPath is invalid : check your launch configuration.")}else t.erlpath="erl";void 0===t.addEbinsToCodepath&&(t.addEbinsToCodepath=!0),this._LaunchArguments=t,this._LaunchArguments.verbose&&this.log(`debugger launchRequest arguments : ${JSON.stringify(t)}`),this.erlangConnection.Start(this._LaunchArguments.verbose).then((t=>{this._port=t,this.sendEvent(new n.InitializedEvent),this.sendResponse(e)})).catch((t=>{this.sendErrorResponse(e,3e3,`Launching debugger throw an error : ${t}`)}))}configurationDoneRequest(e,t){var s=this._LaunchArguments;s.verbose&&(this.debug("Starting erlang"),this.debug(`\tpath      : ${s.cwd}`),this.debug(`\targuments : ${s.arguments}`)),this.erlDebugger.erlangPath=s.erlangPath;var n=i.normalize(i.join(a.erlangBridgePath,"..","ebin"));this.erlDebugger.Start(s.erlpath,s.cwd,this._port,n,s).then((t=>{this.sendResponse(e)})).catch((t=>{this.sendErrorResponse(e,3e3,`Launching application throw an error : ${t}`)}))}disconnectRequest(e,t){this.erlangConnection&&this.erlangConnection.Quit(),this.sendResponse(e),this.erlDebugger.CleanupAfterStart()}quitEvent(e){this.log(`erl exit with code ${e}`),this.quit=!0,this.sendEvent(new n.TerminatedEvent),this.erlDebugger.CleanupAfterStart()}evaluateRequest(e,t){if(this.erlangConnection.isConnected){var s=Math.floor(t.frameId/1e5),n=t.frameId-1e5*s,r=this.thread_id_to_pid(n),i=t.expression;if("hover"===t.context){var o=i.split(":");2===o.length&&(i=o[1])}this.erlangConnection.debuggerEval(r,s.toString(),i).then((t=>{var s=this.mapRawVariables(t);e.body={result:s.value,type:s.type,variablesReference:s.variablesReference},this.sendResponse(e)}))}}setBreakPointsRequest(e,t){let s;s=[];let r=i.basename(t.source.path,".erl");this._conditionalBreakPoints.delete(r),t.breakpoints.forEach((e=>{if(s.push(new n.Breakpoint(!0,e.line,1,new n.Source(r,t.source.path))),e.condition||e.hitCondition||e.logMessage){this._conditionalBreakPoints.has(r)||this._conditionalBreakPoints.set(r,new Map);var i=new h(e.condition,e.hitCondition,e.logMessage);this._conditionalBreakPoints.get(r).set(e.line,i)}})),this._updateBreakPoints(r,s),this._setAllBreakpoints(r),e.body={breakpoints:s},this.sendResponse(e)}_setAllBreakpoints(e){let t=this._breakPoints.filter((t=>t.source.name==e)),s=this._functionBreakPoints.has(e)?this._functionBreakPoints.get(e):[];this.erlangConnection.isConnected?this._LaunchArguments.noDebug||this.erlangConnection.setBreakPointsRequest(e,t,s):this.erlDebugger&&this.erlDebugger.setBreakPointsRequest(t,s)}_updateBreakPoints(e,t){let s=this._breakPoints.filter((t=>t.source.name!=e));this._breakPoints=s.concat(t)}setExceptionBreakPointsRequest(e,t){this.sendResponse(e)}setFunctionBreakPointsRequest(e,t){let s=[],n=new Set,i=new RegExp("^(.+):(.+)/([0-9]+)$");this._functionBreakPoints.forEach(((e,t)=>n.add(t))),this._functionBreakPoints=new Map,t.breakpoints.forEach((e=>{let t=i.exec(e.name);if(t){let n=t[1],i=new r.FunctionBreakpoint(e.id,e.name,n,t[2],+t[3]);s.push(i),this._functionBreakPoints.has(n)?this._functionBreakPoints.get(n).push(i):this._functionBreakPoints.set(n,[i])}else{let t=e.name;t.endsWith(" (Invalid format)")||(t+=" (Invalid format)");let n=new r.FunctionBreakpoint("",t,"","",0);s.push(n)}})),this._functionBreakPoints.forEach(((e,t)=>n.add(t))),n.forEach((e=>this._setAllBreakpoints(e))),e.body={breakpoints:s},this.sendResponse(e)}doProcessUserRequest(e,t,s){this.sendResponse(t),s(this.thread_id_to_pid(e)).then((()=>{this.sendEvent(new n.ContinuedEvent(e,!1))}),(e=>{this.error("unable to continue debugging."),this.sendEvent(new n.TerminatedEvent),this.sendErrorResponse(t,3e3,`Unable to continue debugging : ${e}`)}))}continueRequest(e,t){e.body={allThreadsContinued:!1},this.doProcessUserRequest(t.threadId,e,(e=>this.erlangConnection.debuggerContinue(e)))}nextRequest(e,t){this.doProcessUserRequest(t.threadId,e,(e=>this.erlangConnection.debuggerNext(e)))}stepInRequest(e,t){this.doProcessUserRequest(t.threadId,e,(e=>this.erlangConnection.debuggerStepIn(e)))}stepOutRequest(e,t){var s=this.thread_id_to_pid(t.threadId),n=this.threadIDs[s];n&&n.stack&&1==n.stack.length?this.doProcessUserRequest(t.threadId,e,(e=>this.erlangConnection.debuggerContinue(e))):this.doProcessUserRequest(t.threadId,e,(e=>this.erlangConnection.debuggerStepOut(e)))}pauseRequest(e,t){this.sendResponse(e),this.erlangConnection.debuggerPause(this.thread_id_to_pid(t.threadId)).then((()=>{}),(t=>{this.error("unable to pause."),this.sendErrorResponse(e,3e3,`Unable to pause : ${t}`)}))}scopesRequest(e,t){var s=[],r=Math.floor(t.frameId/1e5),i=t.frameId-1e5*r,o=this.thread_id_to_pid(i);this.erlangConnection.debuggerBindings(o,r.toString()).then((t=>{s=t.map((e=>this.mapRawVariables(e)));var r=new Array,i={name:"Local",value:"",variablesReference:0,children:s};r.push(new n.Scope("Local",this._variableHandles.create(i),!1)),e.body={scopes:r},this.sendResponse(e)}))}variablesRequest(e,t){const s=[],n=this._variableHandles.get(t.variablesReference);null!=n&&n.children.forEach((e=>s.push(e))),e.body={variables:s},this.sendResponse(e)}stackTraceRequest(e,t){var s=this.thread_id_to_pid(t.threadId),r=this.threadIDs[s],a=r.stack;if(r&&a){const s=new Array,h="number"==typeof t.startFrame?t.startFrame:0,l=t.levels,c=Math.min(h+l,a.length);for(let e=h;e<c;e++){var u=a[e];const t=u.func,h=u.source,l=u.line;o.existsSync(h)?s.push(new n.StackFrame(1e5*u.sp+r.thid,t,new n.Source(u.module,this.convertDebuggerPathToClient(h)),this.convertDebuggerLineToClient(l),0)):s.push(new n.StackFrame(1e5*u.sp+r.thid,i.basename(h),null,""))}e.body={stackFrames:s,totalFrames:c-h},this.sendResponse(e)}else e.body={stackFrames:[],totalFrames:0},this.sendResponse(e)}sourceRequest(e,t){this.debug("sourceRequest"),super.sourceRequest(e,t)}convertClientLineToDebugger(e){return this.debug("convertClientLineToDebugger"),super.convertClientLineToDebugger(e)}convertDebuggerLineToClient(e){return super.convertDebuggerLineToClient(e)}convertClientColumnToDebugger(e){return super.convertClientColumnToDebugger(e)}convertDebuggerColumnToClient(e){return super.convertDebuggerColumnToClient(e)}convertClientPathToDebugger(e){return super.convertClientPathToDebugger(e)}convertDebuggerPathToClient(e){var t=i.relative(this._LaunchArguments.cwd,e),s=super.convertDebuggerPathToClient(e);if(t.startsWith(this._rebarBuildPath))if(t=i.relative(i.join(this._LaunchArguments.cwd,this._rebarBuildPath),e),o.existsSync(i.join(this._LaunchArguments.cwd,"apps",t)))s=i.join(this._LaunchArguments.cwd,"apps",t);else{var n=i.parse(this._LaunchArguments.cwd).base;if(t.startsWith(n+i.sep)){var r=i.join(this._LaunchArguments.cwd,"..",t);o.existsSync(r)&&(s=r)}}return s}thread_id_to_pid(e){for(var t in this.threadIDs)if(this.threadIDs[t].thid==e)return t;return"<0.0.0>"}mapRawVariables(e){var t=0;return e.children&&(t=this._variableHandles.create({name:e.name,value:e.value,type:e.type,variablesReference:0,children:e.children.map((e=>this.mapRawVariables(e)))})),{name:e.name,type:e.type,value:e.value,variablesReference:t}}threadCount(){var e=0;for(var t in this.threadIDs)e++;return e}log(e){this.outLine(`${e}\n`)}outLine(e,t){this.sendEvent(new n.OutputEvent(e,t||"console"))}debug(e){this.outLine(`${e}\n`,"debug")}error(e){this.outLine(`${e}\n`,"stderr")}show(){}appendLine(e){this.log(e)}append(e){this.outLine(`${e}`)}onStartListening(e){this._LaunchArguments.verbose&&this.debug(e)}onNewModule(e){this.sendEvent(new n.ModuleEvent("new",new n.Module(e,e)))}onNewBreak(e){}pid_to_number(e){var t=e.substr(1,e.length-2);return t=t.replace(".",""),Number.parseInt(t)}onNewProcess(e){var t=this.pid_to_number(e);this.threadIDs[e]={thid:t,stack:null,vscode:!1};var s=this;setTimeout((function(){s.sendThreadStartedEventIfNeeded(e)}),250)}sendThreadStartedEventIfNeeded(e){var t=this.threadIDs[e];t&&!t.vscode&&(t.vscode=!0,this.sendEvent(new n.ThreadEvent("started",t.thid)))}breakReason(e,t){return this.isOnBreakPoint(e,t)?"breakpoint":""}findConditionalBreakpoint(e,t){if(this._conditionalBreakPoints.has(e)){var s=this._conditionalBreakPoints.get(e),n=parseInt(t);if(s.has(n))return s.get(n)}return null}conditionalBreakpointHit(e,t,s,r,i,o){var a=isNaN(e.hitCount);a||++e.actualHitCount==e.hitCount&&(a=!0),a?e.logMessage?this.handleBracesInLogMessage(t,i,e.logMessage).then((e=>{this.log(e),this.erlangConnection.debuggerContinue(t)})):this.sendEvent(new n.StoppedEvent(this.breakReason(s,r),o)):this.erlangConnection.debuggerContinue(t)}handleBracesInLogMessage(e,t,s){const n=s.match(/^([^{]*){([^}]+)}(.*)$/);if(n){const s=this.erlangConnection.debuggerEval(e,t,n[2]),r=this.handleBracesInLogMessage(e,t,n[3]);return Promise.all([s,r]).then((([e,t])=>n[1]+e.value+t))}return Promise.resolve(s)}onBreak(e,t,s,r){this.sendThreadStartedEventIfNeeded(e);var i=this.threadIDs[e];if(i){i.stack=r;var o=this.findConditionalBreakpoint(t,s);if(o){var a=r&&r.length>0?r[0].sp:-1;o.condition?this.erlangConnection.debuggerEval(e,a,o.condition).then((n=>{"true"==n.value?this.conditionalBreakpointHit(o,e,t,s,a,i.thid):this.erlangConnection.debuggerContinue(e)})):this.conditionalBreakpointHit(o,e,t,s,a,i.thid)}else this.sendEvent(new n.StoppedEvent(this.breakReason(t,s),i.thid))}}isOnBreakPoint(e,t){var s=Number(t);return this._breakPoints.filter((t=>t.line==s&&t.source.name==e)).length>0}onNewStatus(e,t,s,r,i){if("exit"===t){var o=this;setTimeout((function(){var t=o.threadIDs[e];delete o.threadIDs[e],t.vscode&&o.sendEvent(new n.ThreadEvent("exited",t.thid)),0==o.threadCount()&&o.sendEvent(new n.TerminatedEvent)}),125)}}onFbpVerified(e,t,s){this._functionBreakPoints.has(e)&&this._functionBreakPoints.get(e).forEach((e=>{e.functionName===t&&e.arity===s&&(e.verified=!0,this.sendEvent(new n.BreakpointEvent("changed",e)))}))}}t.ErlangDebugSession=l},9703:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(7862),r=s(5812),i=s(1808),o=s(7310);t.Source=class{constructor(e,t,s=0,n,r){this.name=e,this.path=t,this.sourceReference=s,n&&(this.origin=n),r&&(this.adapterData=r)}},t.Scope=class{constructor(e,t,s=!1){this.name=e,this.variablesReference=t,this.expensive=s}},t.StackFrame=class{constructor(e,t,s,n=0,r=0){this.id=e,this.source=s,this.line=n,this.column=r,this.name=t}},t.Thread=class{constructor(e,t){this.id=e,this.name=t||"Thread #"+e}},t.Variable=class{constructor(e,t,s=0,n,r){this.name=e,this.value=t,this.variablesReference=s,"number"==typeof r&&(this.namedVariables=r),"number"==typeof n&&(this.indexedVariables=n)}},t.Breakpoint=class{constructor(e,t,s,n){this.verified=e;const r=this;"number"==typeof t&&(r.line=t),"number"==typeof s&&(r.column=s),n&&(r.source=n)}},t.Module=class{constructor(e,t){this.id=e,this.name=t}},t.CompletionItem=class{constructor(e,t,s=0){this.label=e,this.start=t,this.length=s}};class a extends r.Event{constructor(e,t,s){super("stopped"),this.body={reason:e},"number"==typeof t&&(this.body.threadId=t),"string"==typeof s&&(this.body.text=s)}}t.StoppedEvent=a;class u extends r.Event{constructor(e,t){super("continued"),this.body={threadId:e},"boolean"==typeof t&&(this.body.allThreadsContinued=t)}}t.ContinuedEvent=u;class h extends r.Event{constructor(){super("initialized")}}t.InitializedEvent=h;class l extends r.Event{constructor(e){super("terminated"),("boolean"==typeof e||e)&&(this.body={restart:e})}}t.TerminatedEvent=l;class c extends r.Event{constructor(e,t="console",s){super("output"),this.body={category:t,output:e},void 0!==s&&(this.body.data=s)}}t.OutputEvent=c;class d extends r.Event{constructor(e,t){super("thread"),this.body={reason:e,threadId:t}}}t.ThreadEvent=d;class g extends r.Event{constructor(e,t){super("breakpoint"),this.body={reason:e,breakpoint:t}}}t.BreakpointEvent=g;class p extends r.Event{constructor(e,t){super("module"),this.body={reason:e,module:t}}}t.ModuleEvent=p;class m extends r.Event{constructor(e,t){super("loadedSource"),this.body={reason:e,source:t}}}t.LoadedSourceEvent=m;class b extends r.Event{constructor(e){super("capabilities"),this.body={capabilities:e}}}t.CapabilitiesEvent=b;class v extends r.Event{constructor(e,t,s){super("progressStart"),this.body={progressId:e,title:t},"string"==typeof s&&(this.body.message=s)}}t.ProgressStartEvent=v;class f extends r.Event{constructor(e,t){super("progressUpdate"),this.body={progressId:e},"string"==typeof t&&(this.body.message=t)}}t.ProgressUpdateEvent=f;class _ extends r.Event{constructor(e,t){super("progressEnd"),this.body={progressId:e},"string"==typeof t&&(this.body.message=t)}}var R;t.ProgressEndEvent=_,function(e){e[e.User=1]="User",e[e.Telemetry=2]="Telemetry"}(R=t.ErrorDestination||(t.ErrorDestination={}));class E extends n.ProtocolServer{constructor(e,t){super();const s="boolean"==typeof e&&e;this._debuggerLinesStartAt1=s,this._debuggerColumnsStartAt1=s,this._debuggerPathsAreURIs=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0,this._clientPathsAreURIs=!1,this._isServer="boolean"==typeof t&&t,this.on("close",(()=>{this.shutdown()})),this.on("error",(e=>{this.shutdown()}))}setDebuggerPathFormat(e){this._debuggerPathsAreURIs="path"!==e}setDebuggerLinesStartAt1(e){this._debuggerLinesStartAt1=e}setDebuggerColumnsStartAt1(e){this._debuggerColumnsStartAt1=e}setRunAsServer(e){this._isServer=e}static run(e){let t=0;if(process.argv.slice(2).forEach((function(e,s,n){const r=/^--server=(\d{4,5})$/.exec(e);r&&(t=parseInt(r[1],10))})),t>0)console.error(`waiting for debug protocol on port ${t}`),i.createServer((t=>{console.error(">> accepted connection from client"),t.on("end",(()=>{console.error(">> client connection closed\n")}));const s=new e(!1,!0);s.setRunAsServer(!0),s.start(t,t)})).listen(t);else{const t=new e(!1);process.on("SIGTERM",(()=>{t.shutdown()})),t.start(process.stdin,process.stdout)}}shutdown(){this._isServer||this._isRunningInline()||setTimeout((()=>{process.exit(0)}),100)}sendErrorResponse(e,t,s,n,r=R.User){let i;"number"==typeof t?(i={id:t,format:s},n&&(i.variables=n),r&R.User&&(i.showUser=!0),r&R.Telemetry&&(i.sendTelemetry=!0)):i=t,e.success=!1,e.message=E.formatPII(i.format,!0,i.variables),e.body||(e.body={}),e.body.error=i,this.sendResponse(e)}runInTerminalRequest(e,t,s){this.sendRequest("runInTerminal",e,t,s)}dispatchRequest(e){const t=new r.Response(e);try{if("initialize"===e.command){var s=e.arguments;if("boolean"==typeof s.linesStartAt1&&(this._clientLinesStartAt1=s.linesStartAt1),"boolean"==typeof s.columnsStartAt1&&(this._clientColumnsStartAt1=s.columnsStartAt1),"path"!==s.pathFormat)this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null,R.Telemetry);else{const e=t;e.body={},this.initializeRequest(e,s)}}else"launch"===e.command?this.launchRequest(t,e.arguments,e):"attach"===e.command?this.attachRequest(t,e.arguments,e):"disconnect"===e.command?this.disconnectRequest(t,e.arguments,e):"terminate"===e.command?this.terminateRequest(t,e.arguments,e):"restart"===e.command?this.restartRequest(t,e.arguments,e):"setBreakpoints"===e.command?this.setBreakPointsRequest(t,e.arguments,e):"setFunctionBreakpoints"===e.command?this.setFunctionBreakPointsRequest(t,e.arguments,e):"setExceptionBreakpoints"===e.command?this.setExceptionBreakPointsRequest(t,e.arguments,e):"configurationDone"===e.command?this.configurationDoneRequest(t,e.arguments,e):"continue"===e.command?this.continueRequest(t,e.arguments,e):"next"===e.command?this.nextRequest(t,e.arguments,e):"stepIn"===e.command?this.stepInRequest(t,e.arguments,e):"stepOut"===e.command?this.stepOutRequest(t,e.arguments,e):"stepBack"===e.command?this.stepBackRequest(t,e.arguments,e):"reverseContinue"===e.command?this.reverseContinueRequest(t,e.arguments,e):"restartFrame"===e.command?this.restartFrameRequest(t,e.arguments,e):"goto"===e.command?this.gotoRequest(t,e.arguments,e):"pause"===e.command?this.pauseRequest(t,e.arguments,e):"stackTrace"===e.command?this.stackTraceRequest(t,e.arguments,e):"scopes"===e.command?this.scopesRequest(t,e.arguments,e):"variables"===e.command?this.variablesRequest(t,e.arguments,e):"setVariable"===e.command?this.setVariableRequest(t,e.arguments,e):"setExpression"===e.command?this.setExpressionRequest(t,e.arguments,e):"source"===e.command?this.sourceRequest(t,e.arguments,e):"threads"===e.command?this.threadsRequest(t,e):"terminateThreads"===e.command?this.terminateThreadsRequest(t,e.arguments,e):"evaluate"===e.command?this.evaluateRequest(t,e.arguments,e):"stepInTargets"===e.command?this.stepInTargetsRequest(t,e.arguments,e):"gotoTargets"===e.command?this.gotoTargetsRequest(t,e.arguments,e):"completions"===e.command?this.completionsRequest(t,e.arguments,e):"exceptionInfo"===e.command?this.exceptionInfoRequest(t,e.arguments,e):"loadedSources"===e.command?this.loadedSourcesRequest(t,e.arguments,e):"dataBreakpointInfo"===e.command?this.dataBreakpointInfoRequest(t,e.arguments,e):"setDataBreakpoints"===e.command?this.setDataBreakpointsRequest(t,e.arguments,e):"readMemory"===e.command?this.readMemoryRequest(t,e.arguments,e):"disassemble"===e.command?this.disassembleRequest(t,e.arguments,e):"cancel"===e.command?this.cancelRequest(t,e.arguments,e):"breakpointLocations"===e.command?this.breakpointLocationsRequest(t,e.arguments,e):"setInstructionBreakpoints"===e.command?this.setInstructionBreakpointsRequest(t,e.arguments,e):this.customRequest(e.command,t,e.arguments,e)}catch(e){this.sendErrorResponse(t,1104,"{_stack}",{_exception:e.message,_stack:e.stack},R.Telemetry)}}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsRestartRequest=!1,e.body.supportsExceptionOptions=!1,e.body.supportsValueFormattingOptions=!1,e.body.supportsExceptionInfoRequest=!1,e.body.supportTerminateDebuggee=!1,e.body.supportsDelayedStackTraceLoading=!1,e.body.supportsLoadedSourcesRequest=!1,e.body.supportsLogPoints=!1,e.body.supportsTerminateThreadsRequest=!1,e.body.supportsSetExpression=!1,e.body.supportsTerminateRequest=!1,e.body.supportsDataBreakpoints=!1,e.body.supportsReadMemoryRequest=!1,e.body.supportsDisassembleRequest=!1,e.body.supportsCancelRequest=!1,e.body.supportsBreakpointLocationsRequest=!1,e.body.supportsClipboardContext=!1,e.body.supportsSteppingGranularity=!1,e.body.supportsInstructionBreakpoints=!1,this.sendResponse(e)}disconnectRequest(e,t,s){this.sendResponse(e),this.shutdown()}launchRequest(e,t,s){this.sendResponse(e)}attachRequest(e,t,s){this.sendResponse(e)}terminateRequest(e,t,s){this.sendResponse(e)}restartRequest(e,t,s){this.sendResponse(e)}setBreakPointsRequest(e,t,s){this.sendResponse(e)}setFunctionBreakPointsRequest(e,t,s){this.sendResponse(e)}setExceptionBreakPointsRequest(e,t,s){this.sendResponse(e)}configurationDoneRequest(e,t,s){this.sendResponse(e)}continueRequest(e,t,s){this.sendResponse(e)}nextRequest(e,t,s){this.sendResponse(e)}stepInRequest(e,t,s){this.sendResponse(e)}stepOutRequest(e,t,s){this.sendResponse(e)}stepBackRequest(e,t,s){this.sendResponse(e)}reverseContinueRequest(e,t,s){this.sendResponse(e)}restartFrameRequest(e,t,s){this.sendResponse(e)}gotoRequest(e,t,s){this.sendResponse(e)}pauseRequest(e,t,s){this.sendResponse(e)}sourceRequest(e,t,s){this.sendResponse(e)}threadsRequest(e,t){this.sendResponse(e)}terminateThreadsRequest(e,t,s){this.sendResponse(e)}stackTraceRequest(e,t,s){this.sendResponse(e)}scopesRequest(e,t,s){this.sendResponse(e)}variablesRequest(e,t,s){this.sendResponse(e)}setVariableRequest(e,t,s){this.sendResponse(e)}setExpressionRequest(e,t,s){this.sendResponse(e)}evaluateRequest(e,t,s){this.sendResponse(e)}stepInTargetsRequest(e,t,s){this.sendResponse(e)}gotoTargetsRequest(e,t,s){this.sendResponse(e)}completionsRequest(e,t,s){this.sendResponse(e)}exceptionInfoRequest(e,t,s){this.sendResponse(e)}loadedSourcesRequest(e,t,s){this.sendResponse(e)}dataBreakpointInfoRequest(e,t,s){this.sendResponse(e)}setDataBreakpointsRequest(e,t,s){this.sendResponse(e)}readMemoryRequest(e,t,s){this.sendResponse(e)}disassembleRequest(e,t,s){this.sendResponse(e)}cancelRequest(e,t,s){this.sendResponse(e)}breakpointLocationsRequest(e,t,s){this.sendResponse(e)}setInstructionBreakpointsRequest(e,t,s){this.sendResponse(e)}customRequest(e,t,s,n){this.sendErrorResponse(t,1014,"unrecognized request",null,R.Telemetry)}convertClientLineToDebugger(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e}convertDebuggerLineToClient(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e}convertClientColumnToDebugger(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e}convertDebuggerColumnToClient(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e}convertClientPathToDebugger(e){return this._clientPathsAreURIs!==this._debuggerPathsAreURIs?this._clientPathsAreURIs?E.uri2path(e):E.path2uri(e):e}convertDebuggerPathToClient(e){return this._debuggerPathsAreURIs!==this._clientPathsAreURIs?this._debuggerPathsAreURIs?E.uri2path(e):E.path2uri(e):e}static path2uri(e){"win32"===process.platform&&(/^[A-Z]:/.test(e)&&(e=e[0].toLowerCase()+e.substr(1)),e=e.replace(/\\/g,"/")),e=encodeURI(e);let t=new o.URL("file:");return t.pathname=e,t.toString()}static uri2path(e){let t=new o.URL(e),s=decodeURIComponent(t.pathname);return"win32"===process.platform&&(/^\/[a-zA-Z]:/.test(s)&&(s=s[1].toLowerCase()+s.substr(2)),s=s.replace(/\//g,"\\")),s}static formatPII(e,t,s){return e.replace(E._formatPIIRegexp,(function(e,n){return t&&n.length>0&&"_"!==n[0]?e:s[n]&&s.hasOwnProperty(n)?s[n]:e}))}}E._formatPIIRegexp=/{([^}]+)}/g,t.DebugSession=E},414:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Handles=class{constructor(e){this.START_HANDLE=1e3,this._handleMap=new Map,this._nextHandle="number"==typeof e?e:this.START_HANDLE}reset(){this._nextHandle=this.START_HANDLE,this._handleMap=new Map}create(e){var t=this._nextHandle++;return this._handleMap.set(t,e),t}get(e,t){return this._handleMap.get(e)||t}}},3648:function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?r(e.value):new s((function(t){t(e.value)})).then(o,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=s(7147),i=s(1017),o=s(1890),a=s(9703);var u;!function(e){e[e.Verbose=0]="Verbose",e[e.Log=1]="Log",e[e.Warn=2]="Warn",e[e.Error=3]="Error",e[e.Stop=4]="Stop"}(u=t.LogLevel||(t.LogLevel={}));class h{constructor(){this._pendingLogQ=[]}log(e,t=u.Log){e+="\n",this._write(e,t)}verbose(e){this.log(e,u.Verbose)}warn(e){this.log(e,u.Warn)}error(e){this.log(e,u.Error)}dispose(){if(this._currentLogger){const e=this._currentLogger.dispose();return this._currentLogger=null,e}return Promise.resolve()}_write(e,t=u.Log){e+="",this._pendingLogQ?this._pendingLogQ.push({msg:e,level:t}):this._currentLogger&&this._currentLogger.log(e,t)}setup(e,t,s=!0){const n="string"==typeof t?t:t&&this._logFilePathFromInit;if(this._currentLogger){const t={consoleMinLogLevel:e,logFilePath:n,prependTimestamp:s};this._currentLogger.setup(t).then((()=>{if(this._pendingLogQ){const e=this._pendingLogQ;this._pendingLogQ=null,e.forEach((e=>this._write(e.msg,e.level)))}}))}}init(e,t,s){this._pendingLogQ=this._pendingLogQ||[],this._currentLogger=new l(e,s),this._logFilePathFromInit=t}}t.Logger=h,t.logger=new h;class l{constructor(e,t){this.beforeExitCallback=()=>this.dispose(),this._logCallback=e,this._logToConsole=t,this._minLogLevel=u.Warn,this.disposeCallback=(e,t)=>{this.dispose(),t=t||2,t+=128,process.exit(t)}}setup(e){return n(this,void 0,void 0,(function*(){if(this._minLogLevel=e.consoleMinLogLevel,this._prependTimestamp=e.prependTimestamp,e.logFilePath)if(i.isAbsolute(e.logFilePath)){const s=t=>this.sendLog(`Error creating log file at path: ${e.logFilePath}. Error: ${t.toString()}\n`,u.Error);try{yield(t=i.dirname(e.logFilePath),new Promise(((e,s)=>{o(t,(t=>{t?s(t):e()}))}))),this.log("Verbose logs are written to:\n",u.Warn),this.log(e.logFilePath+"\n",u.Warn),this._logFileStream=r.createWriteStream(e.logFilePath),this.logDateTime(),this.setupShutdownListeners(),this._logFileStream.on("error",(e=>{s(e)}))}catch(e){s(e)}}else this.log(`logFilePath must be an absolute path: ${e.logFilePath}`,u.Error);var t}))}logDateTime(){let e=new Date;const t=e.getUTCFullYear()+"-"+`${e.getUTCMonth()+1}-`+e.getUTCDate()+", "+g();this.log(t+"\n",u.Verbose,!1)}setupShutdownListeners(){process.addListener("beforeExit",this.beforeExitCallback),process.addListener("SIGTERM",this.disposeCallback),process.addListener("SIGINT",this.disposeCallback)}removeShutdownListeners(){process.removeListener("beforeExit",this.beforeExitCallback),process.removeListener("SIGTERM",this.disposeCallback),process.removeListener("SIGINT",this.disposeCallback)}dispose(){return new Promise((e=>{this.removeShutdownListeners(),this._logFileStream?(this._logFileStream.end(e),this._logFileStream=null):e()}))}log(e,t,s=!0){if(this._minLogLevel!==u.Stop){if(t>=this._minLogLevel&&this.sendLog(e,t),this._logToConsole){const s=t===u.Error?console.error:t===u.Warn?console.warn:null;s&&s(d(e))}t===u.Error&&(e=`[${u[t]}] ${e}`),this._prependTimestamp&&s&&(e="["+g()+"] "+e),this._logFileStream&&this._logFileStream.write(e)}}sendLog(e,t){if(e.length>1500){const t=!!e.match(/(\n|\r\n)$/);e=e.substr(0,1500)+"[...]",t&&(e+="\n")}if(this._logCallback){const s=new c(e,t);this._logCallback(s)}}}class c extends a.OutputEvent{constructor(e,t){super(e,t===u.Error?"stderr":t===u.Warn?"console":"stdout")}}function d(e){return e.replace(/(\n|\r\n)$/,"")}function g(){let e=new Date;return p(2,String(e.getUTCHours()))+":"+p(2,String(e.getUTCMinutes()))+":"+p(2,String(e.getUTCSeconds()))+"."+p(3,String(e.getUTCMilliseconds()))+" UTC"}function p(e,t){return t.length>=e?t:String("0".repeat(e)+t).slice(-e)}t.LogOutputEvent=c,t.trimLastNewline=d},8380:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(3648),r=n.logger,i=s(9703);class o extends i.DebugSession{constructor(e,t,s){super(t,s),this.obsolete_logFilePath=e,this.on("error",(e=>{r.error(e.body)}))}start(e,t){super.start(e,t),r.init((e=>this.sendEvent(e)),this.obsolete_logFilePath,this._isServer)}sendEvent(e){if(!(e instanceof n.LogOutputEvent)){let t=e;e instanceof i.OutputEvent&&e.body&&e.body.data&&e.body.data.doNotLogOutput&&(delete e.body.data.doNotLogOutput,t=Object.assign({},e),t.body=Object.assign({},e.body,{output:"<output not logged>"})),r.verbose(`To client: ${JSON.stringify(t)}`)}super.sendEvent(e)}sendRequest(e,t,s,n){r.verbose(`To client: ${JSON.stringify(e)}(${JSON.stringify(t)}), timeout: ${s}`),super.sendRequest(e,t,s,n)}sendResponse(e){r.verbose(`To client: ${JSON.stringify(e)}`),super.sendResponse(e)}dispatchRequest(e){r.verbose(`From client: ${e.command}(${JSON.stringify(e.arguments)})`),super.dispatchRequest(e)}}t.LoggingDebugSession=o},420:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(9703);t.DebugSession=n.DebugSession,t.InitializedEvent=n.InitializedEvent,t.TerminatedEvent=n.TerminatedEvent,t.StoppedEvent=n.StoppedEvent,t.ContinuedEvent=n.ContinuedEvent,t.OutputEvent=n.OutputEvent,t.ThreadEvent=n.ThreadEvent,t.BreakpointEvent=n.BreakpointEvent,t.ModuleEvent=n.ModuleEvent,t.LoadedSourceEvent=n.LoadedSourceEvent,t.CapabilitiesEvent=n.CapabilitiesEvent,t.ProgressStartEvent=n.ProgressStartEvent,t.ProgressUpdateEvent=n.ProgressUpdateEvent,t.ProgressEndEvent=n.ProgressEndEvent,t.Thread=n.Thread,t.StackFrame=n.StackFrame,t.Scope=n.Scope,t.Variable=n.Variable,t.Breakpoint=n.Breakpoint,t.Source=n.Source,t.Module=n.Module,t.CompletionItem=n.CompletionItem,t.ErrorDestination=n.ErrorDestination;const r=s(8380);t.LoggingDebugSession=r.LoggingDebugSession;const i=s(3648);t.Logger=i;const o=s(5812);t.Event=o.Event,t.Response=o.Response;const a=s(414);t.Handles=a.Handles;const u=i.logger;t.logger=u},5812:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){this.seq=0,this.type=e}}t.Message=s,t.Response=class extends s{constructor(e,t){super("response"),this.request_seq=e.seq,this.command=e.command,t?(this.success=!1,this.message=t):this.success=!0}},t.Event=class extends s{constructor(e,t){super("event"),this.event=e,t&&(this.body=t)}}},7862:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2361),r=s(5812);class i{get event(){return this._event||(this._event=(e,t)=>{let s;return this._listener=e,this._this=t,s={dispose:()=>{this._listener=void 0,this._this=void 0}},s}),this._event}fire(e){if(this._listener)try{this._listener.call(this._this,e)}catch(e){}}hasListener(){return!!this._listener}dispose(){this._listener=void 0,this._this=void 0}}class o extends n.EventEmitter{constructor(){super(),this._sendMessage=new i,this._pendingRequests=new Map,this.onDidSendMessage=this._sendMessage.event}dispose(){}handleMessage(e){if("request"===e.type)this.dispatchRequest(e);else if("response"===e.type){const t=e,s=this._pendingRequests.get(t.request_seq);s&&(this._pendingRequests.delete(t.request_seq),s(t))}}_isRunningInline(){return this._sendMessage&&this._sendMessage.hasListener()}start(e,t){this._sequence=1,this._writableStream=t,this._rawData=new Buffer(0),e.on("data",(e=>this._handleData(e))),e.on("close",(()=>{this._emitEvent(new r.Event("close"))})),e.on("error",(e=>{this._emitEvent(new r.Event("error","inStream error: "+(e&&e.message)))})),t.on("error",(e=>{this._emitEvent(new r.Event("error","outStream error: "+(e&&e.message)))})),e.resume()}stop(){this._writableStream&&this._writableStream.end()}sendEvent(e){this._send("event",e)}sendResponse(e){e.seq>0?console.error(`attempt to send more than one response for command ${e.command}`):this._send("response",e)}sendRequest(e,t,s,n){const i={command:e};if(t&&Object.keys(t).length>0&&(i.arguments=t),this._send("request",i),n){this._pendingRequests.set(i.seq,n);const e=setTimeout((()=>{clearTimeout(e);const t=this._pendingRequests.get(i.seq);t&&(this._pendingRequests.delete(i.seq),t(new r.Response(i,"timeout")))}),s)}}dispatchRequest(e){}_emitEvent(e){this.emit(e.event,e)}_send(e,t){if(t.type=e,t.seq=this._sequence++,this._writableStream){const e=JSON.stringify(t);this._writableStream.write(`Content-Length: ${Buffer.byteLength(e,"utf8")}\r\n\r\n${e}`,"utf8")}this._sendMessage.fire(t)}_handleData(e){for(this._rawData=Buffer.concat([this._rawData,e]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){const e=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,e.length>0)try{let t=JSON.parse(e);this.handleMessage(t)}catch(e){this._emitEvent(new r.Event("error","Error handling data: "+(e&&e.message)))}continue}}else{const e=this._rawData.indexOf(o.TWO_CRLF);if(-1!==e){const t=this._rawData.toString("utf8",0,e).split("\r\n");for(let e=0;e<t.length;e++){const s=t[e].split(/: +/);"Content-Length"==s[0]&&(this._contentLength=+s[1])}this._rawData=this._rawData.slice(e+o.TWO_CRLF.length);continue}}break}}}o.TWO_CRLF="\r\n\r\n",t.ProtocolServer=o},2081:e=>{"use strict";e.exports=require("child_process")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},1808:e=>{"use strict";e.exports=require("net")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},7310:e=>{"use strict";e.exports=require("url")}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,s),i.exports}var n={};(()=>{"use strict";var e=n;Object.defineProperty(e,"__esModule",{value:!0});const t=s(1020);t.ErlangDebugSession.run(t.ErlangDebugSession)})(),module.exports=n})();
//# sourceMappingURL=erlangDebug.js.map